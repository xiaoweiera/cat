<script setup lang="ts">
import { defineProps } from 'vue'
import { MenuItem } from '~/logic/topic/props'
import { menuList } from '~/logic/topic/menu'
import DBList from '@fengqiaogang/dblist'
import router, { config } from '~/utils/router'

defineProps({
  data: {
    type: Object
  },
})

// @ts-ignore
const isChild = function(item: MenuItem) {
  if (item && item.children) {
    if (item.children.length > 0) {
      return false
    }
  }
  return true
}

// @ts-ignore
const makeQuery = function(item: MenuItem) {
  const db = new DBList([], 'mid', 'pid', '-1')
  const list = db.flatten(menuList.value, 'children')
  db.insert(list)
  const parent = db.parent<MenuItem>(item)
  const tagID = parent ? parent.id : 'item'
  const topicID = item.id

  const value = router({
    path: config.topic,
    query: { tagID, topicID }
  })
  return value
}
</script>

<template>
  <router-link v-login v-if="isChild(data)" :to="makeQuery(data)" >
    <slot></slot>
  </router-link>
  <label v-login v-else>
    <slot></slot>
  </label>
</template>



