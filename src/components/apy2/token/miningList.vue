<script setup lang="ts">
import { defineProps, onMounted,onBeforeMount,reactive, ref,computed,watch } from 'vue'
import {useProvide,  setInject, getInject } from '~/utils/use/state'
import {chain,rankingTag,tableTag,listTag} from '~/store/apy2/state'
import {getProjectTokenMining_pools} from '~/logic/apy2/index'
import * as R from 'ramda'
import I18n from '~/utils/i18n/index'
const props=defineProps({projectId:Object,symbol:String})
const [project,]=useProvide('project','all')
const [txt,]=useProvide('txt','')
const [filterType,]=useProvide('filterType','all')
const [chained]=useProvide('chained','all')
const projectType=getInject('projectType')
const resultNumber=ref(0)
const param=reactive({
  project_id:project.value[0],
  symbol:props.symbol,
  symbol_type:projectType.value[0] ==='lp'?'lp':filterType.value[0],
  query:'',
  chain:chained.value[0],
  ordering_field:'apy',
  ordering:'desc',
  page:1,
  page_size:10
})
const listData=ref([])
const getList=async (clear:boolean)=>{
  const res=await getProjectTokenMining_pools(param)
  resultNumber.value=res.length
  listData.value=clear?res:listData.value.concat(res)
}
watch(()=>[filterType.value[0],project.value[0],chained.value[0],txt.value[0]],(n)=>{
  param.page=1
  param.symbol_type=n[0]
  param.project_id=n[1]
  param.chain=n[2]
  param.query=n[3]
  getList(true)
})
const more=()=>{
  param.page++
  getList(false)
}
watch(()=>props.symbol,(n)=> {
  param.symbol=n
  getList(false)}
)
watch(()=>[param.ordering_field,param.ordering],()=>getList(true))
//@ts-ignore
onMounted(getList())
</script>
<template>
  <div class="w-full h-full">
    <Apy2MiningPoolsHeader :hasCustom="false" :hasProject="true"  :type="projectType[0]==='lp'?false:true" :hasChain="true"  />
    <Apy2MiningTableMain type='token' page='token_farm_all' origin='token' dialogType='mining'  :param='param' :data="listData" class="mt-3"/>
  </div>
  <div @click="more" v-if="resultNumber===param.page_size" class="mx-auto text-kd14px18px text-global-highTitle text-opacity-65 w-50 py-2 text-center mt-4 hand font-kdFang bg-global-highTitle bg-opacity-6 px-3 py-2  rounded-kd4px">{{I18n.apyIndex.more}}</div>
</template>
<style  lang="scss">

</style>
